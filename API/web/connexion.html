<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Connexion / Inscription - MuSE</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body class="auth-page"> 
    
    <header>
      <a href="accueil.html"><h2>MuSE</h2></a>
      <nav>
        <a href="accueil.html">Accueil</a>
        <a href="playlists.html">Playlists</a>
        <a href="preferences.html">Préférences</a>

        <div class="dropdown">
          <a href="#">API ▾</a>
          <div class="dropdown-content">
            <a href="api-installation.html">Installation</a>
            <a href="api-documentation.html">Documentation</a>
            <a href="api-test.html">Testez l'API</a>
          </div>
        </div>
      </nav>
      <button>
        <a href="connexion.html">Connexion</a>
      </button>
    </header>

    <section class="auth-section">
        
      <h1 class="auth-title">Connectez-vous ou inscrivez-vous !</h1>
      <p class="auth-text">
        Pour utiliser pleinement les fonctionnalités de MuSE, veuillez vous
        connecter à votre compte ou en créer un nouveau. En vous inscrivant,
        vous pourrez personnaliser vos recommandations musicales, créer des
        playlists et bien plus encore !
      </p>

      <div class="auth-card">
        
        <div class="auth-tabs">
          <button class="auth-tab-btn active" id="tab-login" onclick="switchMode('login')">
            Connexion
          </button>
          <button class="auth-tab-btn" id="tab-register" onclick="switchMode('register')">
            Inscription
          </button>
        </div>

        <form id="authForm" class="auth-form" onsubmit="event.preventDefault();">
          
          <p>Champs obligatoires marqués d'un *</p>

          <div id="register-fields-top" class="hidden" style="display: flex; flex-direction: column; gap: 20px;">
            <div class="form-group">
                <label for="user_firstname">Prénom*</label>
                <input type="text" id="user_firstname" placeholder="Votre prénom" />
            </div>
            <div class="form-group">
                <label for="user_lastname">Nom*</label>
                <input type="text" id="user_lastname" placeholder="Votre nom" />
            </div>
          </div>

          <div class="form-group">
              <label for="user_mail">Email*</label>
              <input type="email" id="user_mail" placeholder="Votre email" required />
          </div>
          
          <div class="form-group">
              <label for="user_password">Mot de passe*</label>
              <input type="password" id="user_password" placeholder="Votre mot de passe" required />
          </div>

          <div id="register-fields-bottom" class="hidden" style="display: flex; flex-direction: column; gap: 20px;">
            <div class="form-group">
                <label for="user_age">Âge</label>
                <input type="number" id="user_age" placeholder="Votre âge" min="13" max="120" />
            </div>
            
            <div class="form-group">
                <label for="user_gender">Genre</label>
                <select id="user_gender">
                  <option value="" disabled selected>-- Sélectionnez votre genre --</option>
                  <option value="Homme">Homme</option>
                  <option value="Femme">Femme</option>
                  <option value="Non-binaire">Non-binaire</option>
                  <option value="Autre">Autre</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="user_location">Localisation</label>
                <input type="text" id="user_location" placeholder="Votre localisation" />
            </div>
          </div>

          <button type="submit" id="loginBtn" class="auth-btn">
            Se connecter
          </button>
          <button type="submit" id="registerBtn" class="auth-btn hidden">
            Créer mon compte
          </button>
          
        </form>

        <p id="auth-message"></p>
      </div>
    </section>

    <footer>
      <div class="titre-footer">
        <h2>MuSE</h2>
      </div>
      <div class="navigation-footer">
        <div>
          <p>Société</p>
          <div>
            <a href="#">À propos de nous</a>
            <a href="#">Offre d'emploi</a>
          </div>
        </div>
        <div>
          <p>Liens utiles</p>
          <div>
            <a href="contact.html">Nous contacter</a>
          </div>
        </div>
        <div>
          <p>Communauté</p>
          <div>
            <a href="#">Développeurs</a>
          </div>
        </div>
        <div>
          <p>Légal</p>
          <div>
            <a href="#">Mentions légales</a>
          </div>
        </div>
      </div>
      <div class="barre-separation-footer"></div>
      <div class="fin-footer">
        <div class="reseaux-sociaux-footer">
          <a href="#"><img src="../images/icones/instagram.avif" alt="Instagram" /></a>
          <a href="#"><img src="../images/icones/linkedin.avif" alt="LinkedIn" /></a>
          <a href="#"><img src="../images/icones/github.avif" alt="GitHub" /></a>
          <a href="#"><img src="../images/icones/facebook.avif" alt="Facebook" /></a>
        </div>
        <p>© 2026 MuSE Français</p>
      </div>
    </footer>

    <script>
      const loginBtn = document.getElementById("loginBtn");
      const registerBtn = document.getElementById("registerBtn");
      const message = document.getElementById("auth-message");

      const tabLogin = document.getElementById("tab-login");
      const tabRegister = document.getElementById("tab-register");
      const regFieldsTop = document.getElementById("register-fields-top");
      const regFieldsBottom = document.getElementById("register-fields-bottom");

      // Basculer entre Connexion et Inscription
      function switchMode(mode) {
        message.textContent = "";

        if (mode === "login") {
          tabLogin.classList.add("active");
          tabRegister.classList.remove("active");
          
          regFieldsTop.classList.add("hidden");
          regFieldsBottom.classList.add("hidden");
          
          loginBtn.classList.remove("hidden");
          registerBtn.classList.add("hidden");
        } else if (mode === "register") {
          tabLogin.classList.remove("active");
          tabRegister.classList.add("active");
          
          regFieldsTop.classList.remove("hidden");
          regFieldsBottom.classList.remove("hidden");
          
          loginBtn.classList.add("hidden");
          registerBtn.classList.remove("hidden");
        }
      }

      // Récupération des données du formulaire
      function getFormData() {
        return {
          firstName: document.getElementById("user_firstname").value.trim(),
          lastName: document.getElementById("user_lastname").value.trim(),
          email: document.getElementById("user_mail").value.trim(),
          password: document.getElementById("user_password").value,
          age: parseInt(document.getElementById("user_age").value) || null,
          gender: document.getElementById("user_gender").value.trim() || null,
          location: document.getElementById("user_location").value.trim() || null,
        };
      }

      // Envoi de la requête au Backend
      async function sendAuth(isRegister) {
        const data = getFormData();
        message.textContent = "Traitement en cours...";
        message.style.color = "var(--orange)";

        if (!data.email || !data.password) {
            message.style.color = "#c0392b";
            message.textContent = "Veuillez remplir l'email et le mot de passe.";
            return;
        }

        try {
          const url = "http://localhost:3000/login"; 
          
          const res = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include", 
            body: JSON.stringify(data),
          });

          const result = await res.json();

          if (result.success) {
            message.style.color = "#27ae60"; 
            message.textContent = `Bienvenue, ${result.user.user_firstname || "Utilisateur"} !`;
            
            localStorage.setItem("userId", result.user.user_id);
            localStorage.setItem("userName", result.user.user_firstname);

            setTimeout(() => {
              window.location.href = "accueil.html";
            }, 1500);
          } else {
            message.style.color = "#c0392b"; 
            message.textContent = result.error || "Erreur d'authentification";
          }
        } catch (err) {
          console.error(err);
          message.style.color = "#c0392b";
          message.textContent = "Impossible de joindre le serveur.";
        }
      }

      loginBtn.addEventListener("click", () => sendAuth(false));
      registerBtn.addEventListener("click", () => sendAuth(true));
    </script>
  </body>
</html>