<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Accueil</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://code.jquery.com/ui/1.14.2/jquery-ui.js"></script>
    <script src="script.js"></script>
    <script src="audio-player.js"></script>
</head>
<body class="accueil">
    <header>
            <a href="accueil.html"><h2>MuSE</h2></a> 
            <nav>
                <a href="accueil.html">Accueil</a>
                <a href="playlists.html">Playlists</a>
                <a href="preferences.html">Préférences</a>
                
                <div class="dropdown">
                    <a href="#">API ▾</a>
                    <div class="dropdown-content">
                        <a href="api-installation.html">Installation</a>
                        <a href="api-documentation.html">Documentation</a>
                        <a href="api-test.html">Testez l'API</a>
                    </div>
                </div>
            </nav>
            <button>
                <a href="contact.html">Contact</a>
            </button>
        </header>

    <main>
        <section class="albums">
            <h2>Découvrez de nouveaux albums</h2>
            <div id="albums-container"></div>
        </section>
        <section class="tracks">
            <h2>Musiques que vous pourriez aimer</h2>
            <div id="tracks-container"></div>
        </section>
        <section class="artists">
            <h2>Artistes qui pourraient vous plaire</h2>
            <div id="artists-container"></div>
        </section>
    </main>

    <footer>
        <div class="titre-footer">
            <h2>MuSE</h2>
        </div>
        <div class="navigation-footer">
            <div>
                <p>Société</p>
                <div>
                    <a href="#">À propos de nous</a>
                    <a href="#">Offre d'emploi</a>
                </div>
            </div>
            <div>
                <p>Liens utiles</p>
                <div>
                    <a href="#">Nous contacter</a>
                </div>
            </div>
            <div>
                <p>Communauté</p>
                <div>
                    <a href="#">Développeurs</a>
                </div>
            </div>
            <div>
                <p>Légal</p>
                <div>
                    <a href="#">Mentions légales</a>
                </div>
            </div>
        </div>
        <div class="barre-separation-footer"></div>
        <div class="fin-footer">
            <div class="reseaux-sociaux-footer">
                <a href="#"><img src="../images/icones/instagram.avif" alt="Instagram"/></a>
                <a href="#"><img src="../images/icones/linkedin.avif" alt="LinkedIn"/></a>
                <a href="#"><img src="../images/icones/github.avif" alt="GitHub"/></a>
                <a href="#"><img src="../images/icones/facebook.avif" alt="Facebook"/></a>
            </div>
            <p>© 2026 MuSE Français</p>
        </div>
    </footer>

    <script>
        // Affichage des albums
        document.addEventListener("DOMContentLoaded", function () {
            fetch("http://127.0.0.1:8000/albums?limit=12")
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById("albums-container");
                    data.results.forEach(album => {
                        const albumCard = document.createElement("div");
                        albumCard.classList.add("album-card");
                        let filename = null;
                        if (album.album_image_file) {
                            const match = album.album_image_file.match(/([^/]+\.(jpg|png|jpeg))$/i);
                            filename = match ? match[1] : album.album_image_file;
                        }
                        let imageUrl = "https://freemusicarchive.org/img/default/album.jpg";
                        if (filename) {
                            imageUrl = "https://freemusicarchive.org/image/?file=images%2Falbums%2F" + filename + "&width=290&height=290&type=album";
                        }
                        const artistName = album.artists ? album.artists.split(",")[0].trim() : "Artiste inconnu";
                        albumCard.innerHTML = `
                            <img src="${imageUrl}" alt="${album.album_title}" class="album-cover" onerror="this.src='../images/no_image_music.png'">
                            <div class="album-info">
                                <h3>${album.album_title}</h3>
                                <p>${artistName}</p>
                            </div>
                        `;
                        container.appendChild(albumCard);
                    });
                })
                .catch(error => {
                    console.error("Erreur lors du chargement des albums :", error);
                });
        });

        // Affichage des recommandations de tracks
        document.addEventListener("DOMContentLoaded", function () {
            fetch("http://127.0.0.1:8000/reco/tracks?track_ids=81466")
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById("tracks-container");
                    data.results.forEach(track => {
                        const trackCard = document.createElement("div");
                        trackCard.classList.add("track-card");
                        let filename = null;
                        if (track.track_image_file) {
                            const match = track.track_image_file.match(/([^/]+\.(jpg|png|jpeg))$/i);
                            filename = match ? match[1] : track.track_image_file;
                        }
                        console.log("Track ID:", track.track_id, "Image Filename:", filename);
                        let imageUrl = "../images/no_image_music.png";
                        if (filename) {
                            imageUrl = "https://freemusicarchive.org/image/?file=images%2Falbums%2F" + filename + "&width=290&height=290&type=album";
                        }

                        trackCard.innerHTML = `
                            <img src="${imageUrl}" alt="${track.track_title}" class="track-cover" onerror="this.src='../images/no_image_music.png'">
                            <div class="track-info">
                                <h3>${track.track_title}</h3>
                                <p>${track.artist_name || "Artiste inconnu"}</p>
                            </div>
                        `;
                        trackCard.dataset.trackId = track.track_id;
                        container.appendChild(trackCard);
                    });
                })
                .catch(error => {
                    console.error("Erreur lors du chargement des recommandations de tracks :", error);
                });
        });

        document.addEventListener("DOMContentLoaded", function () {

    fetch("http://127.0.0.1:8000/reco/artists?artist_ids=1")
        .then(response => response.json())
        .then(async data => {

            const container = document.getElementById("artists-container");
            container.innerHTML = "";

            // Récupérer les IDs recommandés
            const artistIds = data.results.map(a => a.artist_id);

            // Faire toutes les requêtes en parallèle
            const artistRequests = artistIds.map(id =>
                fetch(`http://127.0.0.1:8000/artists/${id}`)
                    .then(res => res.json())
            );

            const artistsFullData = await Promise.all(artistRequests);
            console.log("Données complètes des artistes recommandés :", artistsFullData);

            artistsFullData.forEach(artist => {

    let filename = null;

    if (artist.artist_image_file) {
        const match = artist.artist_image_file.match(/([^/]+\.(jpg|png|jpeg))$/i);
        filename = match ? match[1] : artist.artist_image_file;
    }

    let imageUrl = "../images/no_image_artist.png";

    if (filename) {
        imageUrl = "https://freemusicarchive.org/image/?file=images%2Fartists%2F" 
            + filename 
            + "&width=290&height=290&type=artist";
    }

    const artistCard = document.createElement("div");
    artistCard.classList.add("artist-card");

    artistCard.innerHTML = `
        <img src="${imageUrl}" 
             alt="${artist.artist_name}" 
             class="artist-cover"
             onerror="this.src='../images/no_image_artist.png'">
        <h3>${artist.artist_name}</h3>
        <p>Artiste</p>
    `;

    container.appendChild(artistCard);
});

        })
        .catch(error => {
            console.error("Erreur :", error);
        });
});

    </script>

</body>
</html>